<h2 mat-dialog-title>{{ dialogTitle }}</h2>

<mat-dialog-content>
  <mat-tab-group>
    <!-- Catalog Tab -->
    <mat-tab label="Datos del Catálogo">
      <form [formGroup]="catalogForm" class="catalog-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Código</mat-label>
          <input matInput formControlName="code" maxlength="20" required>
          <mat-hint>Código único (max 20 caracteres)</mat-hint>
          <mat-error *ngIf="catalogForm.get('code')?.hasError('required')">
            El código es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="name" maxlength="255" required>
          <mat-error *ngIf="catalogForm.get('name')?.hasError('required')">
            El nombre es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tipo de Tipificación</mat-label>
          <mat-select formControlName="classificationType" required>
            <mat-option *ngFor="let type of classificationTypes" [value]="type">
              {{ getTypeLabel(type) }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="catalogForm.get('classificationType')?.hasError('required')">
            El tipo es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descripción</mat-label>
          <textarea matInput formControlName="description" rows="3"></textarea>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Orden de visualización</mat-label>
            <input matInput type="number" formControlName="displayOrder">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Color (Hex)</mat-label>
            <input matInput formControlName="colorHex" placeholder="#000000">
            <mat-hint>Formato: #RRGGBB</mat-hint>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Icono (Material Icon)</mat-label>
          <input matInput formControlName="iconName" placeholder="check_circle">
          <mat-hint>Nombre del icono de Material Icons</mat-hint>
        </mat-form-field>

        <mat-checkbox formControlName="isActive" *ngIf="isEditMode">
          Activo
        </mat-checkbox>

        <div class="parent-info" *ngIf="data.parentClassification">
          <p><strong>Padre:</strong> {{ data.parentClassification.name }} ({{ data.parentClassification.code }})</p>
          <p><strong>Nivel:</strong> {{ data.parentClassification.hierarchyLevel + 1 }}</p>
        </div>
      </form>
    </mat-tab>

    <!-- Tenant Config Tab -->
    <mat-tab label="Configuración del Cliente">
      <form [formGroup]="configForm" class="config-form">
        <mat-checkbox formControlName="isEnabled">
          Habilitado para este cliente/cartera
        </mat-checkbox>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre personalizado</mat-label>
          <input matInput formControlName="customName">
          <mat-hint>Deja vacío para usar el nombre del catálogo</mat-hint>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Icono personalizado</mat-label>
            <input matInput formControlName="customIcon">
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Color personalizado</mat-label>
            <input matInput formControlName="customColor">
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Orden de visualización</mat-label>
          <input matInput type="number" formControlName="displayOrder">
        </mat-form-field>

        <div class="validation-section">
          <h3>Validaciones</h3>

          <mat-checkbox formControlName="requiresComment">
            Requiere comentario
          </mat-checkbox>

          <div class="form-row" *ngIf="configForm.get('requiresComment')?.value">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Longitud mínima del comentario</mat-label>
              <input matInput type="number" formControlName="minCommentLength">
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Longitud máxima del comentario</mat-label>
              <input matInput type="number" formControlName="maxCommentLength">
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Reglas de validación (JSON)</mat-label>
            <textarea matInput formControlName="validationRules" rows="4"></textarea>
            <mat-hint>Formato JSON para reglas personalizadas</mat-hint>
          </mat-form-field>
        </div>
      </form>
    </mat-tab>
  </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="onSave()">
    {{ isEditMode ? 'Actualizar' : 'Crear' }}
  </button>
</mat-dialog-actions>
